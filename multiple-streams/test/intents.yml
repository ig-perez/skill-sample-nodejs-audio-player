#=====================================================================================================================
#     ______    _ ____  ______        __  _
#    / __/ /__ (_) / / /_  __/__ ___ / /_(_)__  ___ _
#   _\ \/  '_// / / /   / / / -_|_-</ __/ / _ \/ _ `/
#  /___/_/\_\/_/_/_/   /_/  \__/___/\__/_/_//_/\_, /
#                                             /___/
#
# Created by Bespoken
# Learn more at https://read.bespoken.io/unit-testing/getting-started/
#
# Skill name: Audio Player Multiple Streams by Amazon
# Test scope: LaunchRequest, AMAZON.PauseIntent, AMAZON.ResumeIntent, AMAZON.HelpIntent
#             AMAZON.CancelIntent, AMAZON.StopIntent, AMAZON.StartOverIntent
#             AMAZON.NextIntent, AMAZON.PreviousIntent
# Description: Tests an AudioPlayer skill with multiple streams, with previous and next
#=====================================================================================================================

---
configuration:
  locale: en-US
  dynamo: mock
  userId: mockUserID

---
- test: Launch request, no further interaction.
- LaunchRequest:
  - response.outputSpeech.ssml: Welcome to the AWS Podcast. you can ask to play the audio to begin the podcast.
  - response.reprompt.outputSpeech.ssml: You can say, play the audio, to begin.
  - response.shouldEndSession: false
- stop: Goodbye!

---
- test: Launch request and start playing audio.
- begin podcast:
  - response.outputSpeech.ssml: This is Episode 139
  - response.directives[0].type: AudioPlayer.Play # this is equivalent to $..type JSONPath
  - $..playBehavior: REPLACE_ALL
  - $..audioItem.stream.url: "https://feeds.soundcloud.com/stream/274166909-amazon-web-services-306355661-aws-podcast-episode-139.mp3"
  - response.shouldEndSession: true
- stop:
  - response.directives[0].type: AudioPlayer.Stop
- resume: This is Episode 139

---
- test: Pause audio and resume.
- LaunchRequest: You were listening to Episode 139. Would you like to resume?
- begin podcast
- pause # No output is returned
- resume: This is Episode 139
- stop:
  - response.directives[0].type: AudioPlayer.Stop

--- # This sequence works fine with an echo device, resume after cancel fails with skill-tester
- test: Cancel.
- LaunchRequest: You were listening to Episode 139. Would you like to resume?
- begin podcast
- cancel: # No output is returned, but given the code it should say Goodbye!
  - response.directives[0].type: AudioPlayer.Stop
- resume: This is Episode 139
- stop:
  - response.directives[0].type: AudioPlayer.Stop

---
- test: Start audio, next track, previous track, stop.
- LaunchRequest: You were listening to Episode 139. Would you like to resume?
- begin podcast
- next: This is Episode 140
- previous: This is Episode 139
- next: This is Episode 140
- stop:
  - response.directives[0].type: AudioPlayer.Stop

---
- test: Persistence with DynamoDB.
- LaunchRequest: You were listening to Episode 140. Would you like to resume?
- begin podcast:
  - $..audioItem.stream.url: "https://feeds.soundcloud.com/stream/275202399-amazon-web-services-306355661-amazon-web-services.mp3"
- next:
  - response.outputSpeech.ssml: You have reached the end of the playlist
  - response.shouldEndSession: undefined
  - response.directives[0].type: AudioPlayer.Stop

---
- test: Handles AMAZON.ShuffleOnIntent.
- LaunchRequest
- begin podcast
- AMAZON.ShuffleOnIntent:
  - intent: AMAZON.ShuffleOnIntent
  - response.outputSpeech.ssml: This is Episode

---
- test: Handles AMAZON.ShuffleOffIntent.
- LaunchRequest
- begin podcast
- AMAZON.ShuffleOffIntent:
  - intent: AMAZON.ShuffleOffIntent
  - response.outputSpeech.ssml: This is Episode

---
- test: Handles AMAZON.LoopOnIntent.
- LaunchRequest
- begin podcast
- AMAZON.LoopOnIntent:
  - intent: AMAZON.LoopOnIntent
  - response.outputSpeech.ssml: Sorry, this is not a valid command.

---
- test: Handles AMAZON.LoopOffIntent.
- LaunchRequest
- begin podcast
- AMAZON.LoopOffIntent:
  - intent: AMAZON.LoopOffIntent
  - response.outputSpeech.ssml: Sorry, this is not a valid command.

---
- test: Start audio, previous track till the beginning of the list
- LaunchRequest
- begin podcast
- previous
- previous: You have reached the start of the playlist

---
- test: Start audio, next track till the end of the list
- LaunchRequest
- begin podcast
- next
- next: You have reached the end of the playlist